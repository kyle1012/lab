{"ast":null,"code":"import { mergeProps as _mergeProps, createVNode as _createVNode } from \"vue\";\n// Styles\nimport \"./VDialog.css\";\n\n// Components\nimport { VDialogTransition } from \"../transitions/index.mjs\";\nimport { VDefaultsProvider } from \"../VDefaultsProvider/index.mjs\";\nimport { VOverlay } from \"../VOverlay/index.mjs\"; // Composables\nimport { makeTransitionProps } from \"../../composables/transition.mjs\";\nimport { useProxiedModel } from \"../../composables/proxiedModel.mjs\";\nimport { useScopeId } from \"../../composables/scopeId.mjs\";\nimport { forwardRefs } from \"../../composables/forwardRefs.mjs\"; // Utilities\nimport { nextTick, ref, watch } from 'vue';\nimport { genericComponent, IN_BROWSER, useRender } from \"../../util/index.mjs\";\nexport const VDialog = genericComponent()({\n  name: 'VDialog',\n  inheritAttrs: false,\n  props: {\n    fullscreen: Boolean,\n    origin: {\n      type: String,\n      default: 'center center'\n    },\n    retainFocus: {\n      type: Boolean,\n      default: true\n    },\n    scrollable: Boolean,\n    modelValue: Boolean,\n    ...makeTransitionProps({\n      transition: {\n        component: VDialogTransition\n      }\n    })\n  },\n  emits: {\n    'update:modelValue': value => true\n  },\n  setup(props, _ref) {\n    let {\n      attrs,\n      slots\n    } = _ref;\n    const isActive = useProxiedModel(props, 'modelValue');\n    const {\n      scopeId\n    } = useScopeId();\n    const overlay = ref();\n    function onFocusin(e) {\n      var _overlay$value, _overlay$value2;\n      const before = e.relatedTarget;\n      const after = e.target;\n      if (before !== after && (_overlay$value = overlay.value) != null && _overlay$value.contentEl &&\n      // We're the topmost dialog\n      (_overlay$value2 = overlay.value) != null && _overlay$value2.globalTop &&\n      // It isn't the document or the dialog body\n      ![document, overlay.value.contentEl].includes(after) &&\n      // It isn't inside the dialog body\n      !overlay.value.contentEl.contains(after)) {\n        const focusable = [...overlay.value.contentEl.querySelectorAll('button, [href], input:not([type=\"hidden\"]), select, textarea, [tabindex]:not([tabindex=\"-1\"])')].filter(el => !el.hasAttribute('disabled') && !el.matches('[tabindex=\"-1\"]'));\n        if (!focusable.length) return;\n        const firstElement = focusable[0];\n        const lastElement = focusable[focusable.length - 1];\n        if (before === firstElement) {\n          lastElement.focus();\n        } else {\n          firstElement.focus();\n        }\n      }\n    }\n    if (IN_BROWSER) {\n      watch(() => isActive.value && props.retainFocus, val => {\n        val ? document.addEventListener('focusin', onFocusin) : document.removeEventListener('focusin', onFocusin);\n      }, {\n        immediate: true\n      });\n    }\n    watch(isActive, async val => {\n      await nextTick();\n      if (val) {\n        var _contentEl;\n        (_contentEl = overlay.value.contentEl) == null ? void 0 : _contentEl.focus({\n          preventScroll: true\n        });\n      } else {\n        var _activatorEl;\n        (_activatorEl = overlay.value.activatorEl) == null ? void 0 : _activatorEl.focus({\n          preventScroll: true\n        });\n      }\n    });\n    useRender(() => _createVNode(VOverlay, _mergeProps({\n      \"modelValue\": isActive.value,\n      \"onUpdate:modelValue\": $event => isActive.value = $event,\n      \"class\": ['v-dialog', {\n        'v-dialog--fullscreen': props.fullscreen,\n        'v-dialog--scrollable': props.scrollable\n      }],\n      \"transition\": props.transition,\n      \"scrollStrategy\": \"block\",\n      \"ref\": overlay,\n      \"aria-role\": \"dialog\",\n      \"aria-modal\": \"true\",\n      \"activatorProps\": {\n        'aria-haspopup': 'dialog',\n        'aria-expanded': String(isActive.value)\n      },\n      \"z-index\": 2400\n    }, scopeId, attrs), {\n      activator: slots.activator,\n      default: function () {\n        var _slots$default;\n        for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n          args[_key] = arguments[_key];\n        }\n        return _createVNode(VDefaultsProvider, {\n          \"root\": true\n        }, {\n          default: () => [(_slots$default = slots.default) == null ? void 0 : _slots$default.call(slots, ...args)]\n        });\n      }\n    }));\n    return forwardRefs({}, overlay);\n  }\n});","map":{"version":3,"mappings":"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","names":["VDialogTransition","VDefaultsProvider","VOverlay","makeTransitionProps","useProxiedModel","useScopeId","forwardRefs","nextTick","ref","watch","genericComponent","IN_BROWSER","useRender","VDialog","name","inheritAttrs","props","fullscreen","Boolean","origin","type","String","default","retainFocus","scrollable","modelValue","transition","component","emits","value","setup","attrs","slots","isActive","scopeId","overlay","onFocusin","e","before","relatedTarget","after","target","_overlay$value","contentEl","_overlay$value2","globalTop","document","includes","contains","focusable","querySelectorAll","filter","el","hasAttribute","matches","length","firstElement","lastElement","focus","val","addEventListener","removeEventListener","immediate","_contentEl","preventScroll","activatorEl","_activatorEl","activator","args","_slots$default"],"sources":["../../../src/components/VDialog/VDialog.tsx"],"sourcesContent":["// Styles\nimport './VDialog.sass'\n\n// Components\nimport { VDialogTransition } from '@/components/transitions'\nimport { VDefaultsProvider } from '@/components/VDefaultsProvider'\nimport { VOverlay } from '@/components/VOverlay'\n\n// Composables\nimport { makeTransitionProps } from '@/composables/transition'\nimport { useProxiedModel } from '@/composables/proxiedModel'\nimport { useScopeId } from '@/composables/scopeId'\nimport { forwardRefs } from '@/composables/forwardRefs'\n\n// Utilities\nimport { nextTick, ref, watch } from 'vue'\nimport { genericComponent, IN_BROWSER, useRender } from '@/util'\n\nexport const VDialog = genericComponent<new () => {\n  $props: VOverlay['$props']\n}>()({\n  name: 'VDialog',\n\n  inheritAttrs: false,\n\n  props: {\n    fullscreen: Boolean,\n    origin: {\n      type: String,\n      default: 'center center',\n    },\n    retainFocus: {\n      type: Boolean,\n      default: true,\n    },\n    scrollable: Boolean,\n    modelValue: Boolean,\n\n    ...makeTransitionProps({\n      transition: { component: VDialogTransition },\n    }),\n  },\n\n  emits: {\n    'update:modelValue': (value: boolean) => true,\n  },\n\n  setup (props, { attrs, slots }) {\n    const isActive = useProxiedModel(props, 'modelValue')\n    const { scopeId } = useScopeId()\n\n    const overlay = ref<VOverlay>()\n    function onFocusin (e: FocusEvent) {\n      const before = e.relatedTarget as HTMLElement | null\n      const after = e.target as HTMLElement | null\n\n      if (\n        before !== after &&\n        overlay.value?.contentEl &&\n        // We're the topmost dialog\n        overlay.value?.globalTop &&\n        // It isn't the document or the dialog body\n        ![document, overlay.value.contentEl].includes(after!) &&\n        // It isn't inside the dialog body\n        !overlay.value.contentEl.contains(after)\n      ) {\n        const focusable = [...overlay.value.contentEl.querySelectorAll(\n          'button, [href], input:not([type=\"hidden\"]), select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n        )].filter(el => !el.hasAttribute('disabled') && !el.matches('[tabindex=\"-1\"]')) as HTMLElement[]\n\n        if (!focusable.length) return\n\n        const firstElement = focusable[0]\n        const lastElement = focusable[focusable.length - 1]\n\n        if (before === firstElement) {\n          lastElement.focus()\n        } else {\n          firstElement.focus()\n        }\n      }\n    }\n\n    if (IN_BROWSER) {\n      watch(() => isActive.value && props.retainFocus, val => {\n        val\n          ? document.addEventListener('focusin', onFocusin)\n          : document.removeEventListener('focusin', onFocusin)\n      }, { immediate: true })\n    }\n\n    watch(isActive, async val => {\n      await nextTick()\n      if (val) {\n        overlay.value!.contentEl?.focus({ preventScroll: true })\n      } else {\n        overlay.value!.activatorEl?.focus({ preventScroll: true })\n      }\n    })\n\n    useRender(() => (\n      <VOverlay\n        v-model={ isActive.value }\n        class={[\n          'v-dialog',\n          {\n            'v-dialog--fullscreen': props.fullscreen,\n            'v-dialog--scrollable': props.scrollable,\n          },\n        ]}\n        transition={ props.transition }\n        scrollStrategy=\"block\"\n        ref={ overlay }\n        aria-role=\"dialog\"\n        aria-modal=\"true\"\n        activatorProps={{\n          'aria-haspopup': 'dialog',\n          'aria-expanded': String(isActive.value),\n        }}\n        z-index={ 2400 }\n        { ...scopeId }\n        { ...attrs }\n      >\n        {{\n          activator: slots.activator,\n          default: (...args) => (\n            <VDefaultsProvider root>\n              { slots.default?.(...args) }\n            </VDefaultsProvider>\n          ),\n        }}\n      </VOverlay>\n    ))\n\n    return forwardRefs({}, overlay)\n  },\n})\n\nexport type VDialog = InstanceType<typeof VDialog>\n"]},"metadata":{},"sourceType":"module"}